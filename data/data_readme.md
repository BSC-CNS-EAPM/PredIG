# Datasets
## Antigen types, experimental sources & immunogenicity label harmonization
To obtain a sizeable dataset for machine-learning modelling, we retrieved 17448 pairs of epitope and HLA-I allele (pHLAs) with validated immunogenicity, from public databases48,50,65 and from recent literature4,41,49,66 in September 2023. As for disease of origin, our dataset contains epitopes derived from pathogens and from cancer including neoantigens, tumor-associated antigens and non-canonical cancer antigens. Experimental validations comprise T-cell reactivity assays such as IFN-γ ELISpot, 41BB staining or TNFα-release and T-cell binding assays such as MHC-tetramers and multimers. The experimental results are considered ground truth and used as immunogenicity label. Pairs of epitope and HLA allele (pHLA) validated as "positive", "positive-low", "positive-intermediate" and "positive-high" are harmonized as "positive" for binarization of the label. pHLAs labeled as "negative" maintain the same label. Among pHLA cases with more than a single validation experiment, those with at least one responsive subject were considered positive and the remaining negative instances were discarded to avoid discording/discrepant immunogenicity labels for the same pHLA. This criterion is based on the fact that each T-cell assay replicate/experiment uses a unique T-cell sample with polyclonal TCRs and diverse T-cell states. Thus, one finding of immunogenicity validates the ground truth of a pHLA instance whereas a negative finding does not invalidate it because it can imply the absence of the responsive TCR or the presence of non-effector T-cell states in the sample.

## Data Curation
All datasets were curated in a series of general quality filters and a subset of dataset-specific filters. The general filters include HLA nomenclature standardization to discard alleles/cases with missing or insufficient information (explained below); epitope length between 8 and 15 amino acids and at least one patient tested for all cases and one patient responding for positive cases. Duplicates between datasets were removed based on pHLA identity (e.g. concatenating epitope sequence and standardized HLA allele) maintaining the positive instances in cases of discording annotation.

We adapted HLA allele ontologies68 to focus on experiments performed on mono-allelic cell lines or on epitopes predicted as binders for a single HLA-I allele of the antigen presenting cells used in the assay. IEDB50 data was curated as follows: host organism was restricted to “Homo sapiens” to only include epitopes tested against human T cells; MHCType was restricted to "MHC-I"; the dataset was split by Epitope.Relationship into "neo-epitope" for cancer datasets and "pathogen" for pathogenic datasets and MHC allele restriction was refined using HLA Allele Ontologies68; Allele.Evidence.Code was used to discard "not determined" instances. Data from LANL73 and HCV databases74 was retrieved using Repitope63). and curated as in IEDB. TANTIGEN v1.065 and v2.048 data only contains positive cases, the number of subjects tested and the experimental source are annotated in the original publication. In PRIME v1.041, we discarded data coming from the studies "Calis", "Dengue" and "Random" for HLA resolution limitations; the number of subjects tested, responded and experimental source depend on the specific study41. The non-canonical tumoral antigen dataset was retrieved from Gros et al66 and curated by the "nonC-TL" antigen category to include alternative reading frames (OffFrame), intronic, intergenic, non-coding regions (non-CDS) and 5' and 3' (UTR5, UTR3). This dataset was validated by IFN-γ ELISpots and 41BB stainings. SARS-CoV-2 data retrieved from Schumacher et al.4 was curated using general filters exclusively and validated by pHLA multimer assays. TESLA data for cancer neoantigens was curated using general filters and validated using pHLA multimers49. Tran et al data including cancer neoantigens from gastrointestinal tumors was curated using general filters and validated by IFN-γ ELISpots and 41BB staining67. 

## HLA nomenclature standardization
We only retained those pHLA points with 4-digits of HLA resolution, necessary to perform reliable binding predictions (Figure 2B) and their nomenclature was standardized to the HLA allele nomenclature established by the WHO Nomenclature Committee for Factors of the HLA System92, which is as follows: HLA-(Gene)*(Allele group) : (specific HLA protein or allotype). For instance, HLA-A*02:01. Data points with insufficient allelic annotation were discarded (e.g. HLA-A2). Data points with deeper resolution were restricted to non-synonymous modifications specified by 4-digits (e.g. HLA-A*01:01:03 > HLA-A*01:01). All annotations that did not follow the standardized symbols were harmonized into 4-digits (e.g. HLA-A0101 > HLA-A*01:01).

## Data Splits
The training set includes 13073 pHLA pairs (6114 tumoral and 6959 of pathogen origin, of which 5006 were validated as immunogenic and 8067 as non-immunogenic) curated from the IEDB50, LANL73, HCV74,93, TANTIGEN v1.065 and PRIME v1.041. The training set was split for internal model optimization using a 5-fold cross-validation coupled to a grid search exploration of XGBoost hyperparameters. Independently, three held-out sets were retrieved from recent publications4,66, TESLA consortium49 and TANTIGEN v2.048, from which we removed any pHLA pair found in the training set to avoid data leakage. These are antigen-type-specific including a cancer neoantigen dataset (Held-out 1, n = 3564), a non-canonical cancer antigen dataset (Held-out 2, n = 560) and a pathogen dataset containing SARS-CoV-2 T-cell epitopes (Held-out 3, n = 243). 
